#预处理
# 预处理
预处理(或称预编译)是指在进行编译的第一遍扫描(词法扫描和语法分析)之前所作的工作。预处理指令指示在程序正式编译前就由编译器进行的操作，可放在程序中任何位置。
## 宏定义
   C语言源程序中允许用一个标识符来表示一个字符串，称为“宏”。被定义为宏的标识符称为“宏名”。在编译预处理时，对程序中所有出现的宏名，都用宏定义中的字符串去代换，这称为宏**替换**或宏展开。
### 无参宏定义
`#define MAX_SIZE 20`
这个指令告诉预处理器：将文本中所有的 MAX_SIZE 替换为 20。MAX_SIZE 通常被称为 **宏** 。
实际上，我们一般使用 const 常量去替代宏。这是因为：
-   const 有数据类型，而宏定义只是进行简单的替换。有数据类型便于编译器进行安全检查。
-   宏定义的常量在所有出现的地方被替换成了字面量，因此每一次出现都会占用一部分内存；而 const 定义的常量只占有一份空间，避免了不必要的内存分配，提高效率。
-   const 定义的常量更加便于控制其作用域。

***注意事项***
-   宏名一般用大写字母表示，以便于与变量区别。
-   宏定义末尾不必加分号，否则连分号一并替换。
-   宏定义可以嵌套。
-   可用#undef命令终止宏定义的作用域。
-   使用宏可提高程序通用性和易读性，减少不一致性，减少输入错误和便于修改。如数组大小常用宏定义。
-   预处理是在编译之前的处理，而编译工作的任务之一就是语法检查，预处理不做语法检查。
-   宏定义写在函数的花括号外边，作用域为其后的程序，通常在文件的最开头。
-   字符串" "中永远不包含宏，否则该宏名当字符串处理。
-   宏定义不分配内存，变量定义分配内存。

### 带参数的宏
`#define min(a, b) (a < b ? a : b)`
`#define C(r) (2 * 3.14 * (r))`
这些指令类似函数，但实际上也只会在编译过程中进行替换，实质上是 **带参数的宏** 。值得注意的是，宏函数外需要添加括号，宏函数内使用参数时也需要添加括号。否则可能会出现如下错误：
```c
int r = 1, s = 2;
min(r, s) + 4
// 带括号：(r < s ? r : s)+4=5
// 不带括号：r<s?r:s+4=1

C(r+s)
// 带括号：2 * 3.14 * (r+s) = 
// 不带括号：2 * 3.14 * r + s = 
```

***注意事项***
-   宏名和形参表的括号间不能有空格。
-   宏替换只作替换，不做计算，不做表达式求解。
-   函数调用在编译后程序运行时进行，并且分配内存。宏替换在编译前进行，不分配内存。
-   宏的哑实结合不存在类型，也没有类型转换。
-   函数只有一个返回值，利用宏则可以设法得到多个值。
-   宏展开使源程序变长，函数调用不会。
-   宏展开不占用运行时间，只占编译时间，函数调用占运行时间(分配内存、保留现场、值传递、返回值)。
-   为防止无限制递归展开，当宏调用自身时，不再继续展开。如：#define TEST(x)  (x + TEST(x))被展开为1 + TEST(1)。
### 宏定义的取消
```c
#define 
#undef

// example
#define PI   3.14159
int main(void){
    //……
}
#undef PI
int func(void){
    //……
}
```
`#undef MAX_SIZE`
这个指令告诉处理器：MAX_SIZE 的宏定义至此终止。

`#define保护`
为了防止头文件被多次包含，我们可以使用`#define` 来进行保护。例如：
```c
#ifndef _MYHEADER_H
#define _MYHEADER_H
#include "myheader.h"
#endif
```

### 文件包含
文件包含实际上是将被包含的文件在代码中展开。经典例子是包含头文件。其语法是：

`#include <_FILE_NAME_>`          在系统库中寻找文件

`#include "_FILE_NAME_"`            现在当前工作目录中寻找文件，找不到再去系统库寻找

### 条件编译
```c
#ifdef  

#else

#endif
// 如果标识符已被#define命令定义过，则对程序段1进行编译；否则对程序段2进行编译。如果没有程序段2(它为空)，#else可以没有，即可以写为：

#ifdef

#endif

// ex

```


`#if #elif #else #endif`是一组条件编译的语句。例如：
```c
#include<stdio.h>
#define MAX 100
#define MIN 1

#if MAX>99 && MIN>10
	#include"ver1.h"
#elif MIN>3
	#include"ver2.h"
#else
	#include"ver3.h"
#endif
```
此时，代码会将 "ver3.h" 包含，而不会包含 "ver1.h" 和 "ver2.h"。


`#ifdef #ifndef` 可以用来判断是否存在某个宏定义。例如：
```c
#include<stdio.h>
#define MIN 1
int main(){
#ifndef MIN
#define MIN 10
    printf("%d", MIN);
#endif
    printf("%d", MIN);
    return 0;
}
```
输出为1

如果希望同时判断多个宏定义的存在性，可以使用 defined()。例如：
```c
#include<stdio.h>
#define MAX 100
#define MIN 1
int main(){
#if (defined(MAX) || !defined(MIN))
#define MIN 10
    printf("%d", MIN);
#endif
    printf("%d", MIN);
    return 0;
}
```
输出为1010
